# ---------- GLOBAL SCOPE -----------
S -> USES GLOBALS
  USES -> USE USES | USE
  USE -> use RELATIVE_PATH semicolon
    RELATIVE_PATH -> dot RELATIVE_PATH | MODULE
      MODULE -> id dot MODULE | id

  GLOBALS -> GLOBAL GLOBALS | GLOBAL
  GLOBAL -> GLOBAL_DECLARATION | FUNCTION
    # A global declaration is like a regular assignment,
    # except always uses "=" and cannot be grouped.
    GLOBAL_DECLARATION -> MAYBE_TYPED_ID eq EXPRESSION
      MAYBE_TYPED_ID -> id colon TYPE | id
        TYPE -> id lt TYPES gt | id
        TYPES -> TYPE comma TYPES | TYPE
    FUNCTION -> fn id opar TYPED_IDS cpar BLOCK
      TYPED_IDS -> id colon TYPE comma TYPED_IDS | id colon TYPE
      # Block is defined at the end



# ---------- EXPRESSIONS ----------
EXPRESSION -> opar EXPRESSION cpar

# Bitwise: highest priority, it's grouped first
# That means small chunks: 1 + 3 ^ 5 or 0 -> 1 + (3 ^ 5) or 0
%left hat amp bar
EXPRESSION -> EXPRESSION hat EXPRESSION
EXPRESSION -> EXPRESSION amp EXPRESSION
EXPRESSION -> EXPRESSION bar EXPRESSION

# Arithmetic
# 1 + 2 * 3 * 4 / 4 -> 1 + (((2 * 3) * 4) / 4)
%left star slash plus minus
EXPRESSION -> EXPRESSION star EXPRESSION
EXPRESSION -> EXPRESSION slash EXPRESSION
EXPRESSION -> EXPRESSION plus EXPRESSION
EXPRESSION -> EXPRESSION minus EXPRESSION

# Comparison
# 2 + 1 == 3 -> (2 + 1) == (3)
%nonassoc deq neq lt leq gt geq
EXPRESSION -> EXPRESSION deq EXPRESSION
EXPRESSION -> EXPRESSION neq EXPRESSION
EXPRESSION -> EXPRESSION lt EXPRESSION
EXPRESSION -> EXPRESSION leq EXPRESSION
EXPRESSION -> EXPRESSION gt EXPRESSION
EXPRESSION -> EXPRESSION geq EXPRESSION

# Logic: lowest priority, grouped at the end
# This means bigger chunks: 1 + 3 or 0 -> (1 + 3) or (0)
%left not and or
EXPRESSION -> not EXPRESSION
EXPRESSION -> EXPRESSION and EXPRESSION
EXPRESSION -> EXPRESSION or EXPRESSION

# Assignments
EXPRESSION -> ASSIGNMENT
%right eq
ASSIGNMENT -> LHS eq RHS
%nonassoc pluseq minuseq stareq slasheq hateq ampeq bareq
ASSIGNMENT -> LHS pluseq RHS
ASSIGNMENT -> LHS minuseq RHS
ASSIGNMENT -> LHS stareq RHS
ASSIGNMENT -> LHS slasheq RHS
ASSIGNMENT -> LHS hateq RHS
ASSIGNMENT -> LHS ampeq RHS
ASSIGNMENT -> LHS bareq RHS

LHS -> MAYBE_TYPED_ID comma LHS | MAYBE_TYPED_ID
%left comma
RHS -> EXPRESSION comma RHS
%hint eq
RHS -> EXPRESSION



# ---------- CONTROL ----------
#CONTROL -> EPSILON



# ---------- CONDITIONAL ----------
#CONDITIONAL -> EPSILON



# ---------- LOOP ----------
#LOOP -> EPSILON



# ---------- BLOCK ----------
BLOCK -> obraces STATEMENTS obraces
  STATEMENTS -> STATEMENT semicolon STATEMENTS | STATEMENT semicolon
  STATEMENT -> EXPRESSION
